# Section 6

#### Table of Contents

1. [Introduction to SQL Server Object Dependencies](01_introduction_database_dependencies.md)
2. [Create Demo Databases and Schemas](02_create_demo_databases_and_schemas.md)
3. [Database Dependencies Examples](03_database_dependencies_examples.md)
4. [Database Dependencies Analysis](04_database_dependencies_analysis.md)
5. [Determine Object Dependency Paths](05_determine_object_dependency_paths.md)
6. [Determine Foreign Key Paths](06_determine_foreign_key_paths.md)

<img src="https://raw.githubusercontent.com/smpetersgithub/AdvancedSQLPuzzles/main/images/AdvancedSQLPuzzles_image.png" alt="Advanced SQL Puzzles" width="200"/>

# Determine Foreign Key Paths

[üìÑ The corresponding scripts for this walkthrough are available here.](https://github.com/smpetersgithub/AdvancedSQLPuzzles/tree/main/Database%20Articles/Database%20Dependencies/)

Next, we‚Äôll focus on determining foreign key paths. This is similar to determining object dependency paths, but here we focus exclusively on foreign key dependencies. A script provided at the end of this chapter automates this process.

Foreign key dependencies can be viewed via the system views `sys.foregn_keys` and `sys.foreign_key_columns`.  Foreign Key dependencies are not part of the `sys.sql_Expression_dependencies` table.

Foreign keys cannot be created across databases, so unlike object dependency paths, we do not need to account for cross-database foreign keys.  Before you run the script, you will need to modify the `USE` statement to use the correct database.

Before running the script, we will cover a few key concepts.

----

### Example Output

First, we‚Äôll review the example output generated by the script.

These examples are based on Microsoft‚Äôs publicly available `WorldWideImporters` database.

The following illustrates a foreign key path for the `Sales.Orders` table. From this output, we can identify all objects that the table depends on via foreign keys, as well as the dependencies of those related tables.

üîç Objects are labeled using a three-part naming convention: `<server_name>.<schema_name>.<object_name>`

----

| Table Name                          | Path                                                                   | Depth | Object ID Path                          |
|-------------------------------------|------------------------------------------------------------------------|-------|-----------------------------------------|
| Sales.Orders                        | Sales.Orders                                                           | 0     | 1154103152                              |
| Application.People                  | Sales.Orders ‚û°Ô∏è Application.People                                     | 1     | 1154103152 ‚û°Ô∏è 1301579675               |
| Application.Cities                  | Sales.Orders ‚û°Ô∏è Application.People ‚û°Ô∏è Application.Cities               | 2     | 1154103152 ‚û°Ô∏è 1301579675 ‚û°Ô∏è 402100473  |
| Application.Countries               | Sales.Orders ‚û°Ô∏è Application.People ‚û°Ô∏è Application.Countries            | 2     | 1154103152 ‚û°Ô∏è 1301579675 ‚û°Ô∏è 1461580245 |
| Application.DeliveryMethods         | Sales.Orders ‚û°Ô∏è Application.People ‚û°Ô∏è Application.DeliveryMethods      | 2     | 1154103152 ‚û°Ô∏è 1301579675 ‚û°Ô∏è 1573580644 |
| Application.PaymentMethods          | Sales.Orders ‚û°Ô∏è Application.People ‚û°Ô∏è Application.PaymentMethods       | 2     | 1154103152 ‚û°Ô∏è 1301579675 ‚û°Ô∏è 1669580986 |
| Application.StateProvinces          | Sales.Orders ‚û°Ô∏è Application.People ‚û°Ô∏è Application.StateProvinces       | 2     | 1154103152 ‚û°Ô∏è 1301579675 ‚û°Ô∏è 290100074  |
| Application.SystemParameters        | Sales.Orders ‚û°Ô∏è Application.People ‚û°Ô∏è Application.SystemParameters     | 2     | 1154103152 ‚û°Ô∏è 1301579675 ‚û°Ô∏è 498100815  |
| Application.TransactionTypes        | Sales.Orders ‚û°Ô∏è Application.People ‚û°Ô∏è Application.TransactionTypes     | 2     | 1154103152 ‚û°Ô∏è 1301579675 ‚û°Ô∏è 1765581328 |
| Purchasing.PurchaseOrderLines       | Sales.Orders ‚û°Ô∏è Application.People ‚û°Ô∏è Purchasing.PurchaseOrderLines    | 2     | 1154103152 ‚û°Ô∏è 1301579675 ‚û°Ô∏è 1554104577 |
| Purchasing.PurchaseOrders           | Sales.Orders ‚û°Ô∏è Application.People ‚û°Ô∏è Purchasing.PurchaseOrders        | 2     | 1154103152 ‚û°Ô∏è 1301579675 ‚û°Ô∏è 1026102696 |
| Purchasing.SupplierCategories       | Sales.Orders ‚û°Ô∏è Application.People ‚û°Ô∏è Purchasing.SupplierCategories    | 2     | 1154103152 ‚û°Ô∏è 1301579675 ‚û°Ô∏è 1861581670 |
| Purchasing.Suppliers                | Sales.Orders ‚û°Ô∏è Application.People ‚û°Ô∏è Purchasing.Suppliers             | 2     | 1154103152 ‚û°Ô∏è 1301579675 ‚û°Ô∏è 610101214  |
| Purchasing.SupplierTransactions     | Sales.Orders ‚û°Ô∏è Application.People ‚û°Ô∏è Purchasing.SupplierTransactions  | 2     | 1154103152 ‚û°Ô∏è 1301579675 ‚û°Ô∏è 1682105033 |
| Sales.BuyingGroups                  | Sales.Orders ‚û°Ô∏è Application.People ‚û°Ô∏è Sales.BuyingGroups               | 2     | 1154103152 ‚û°Ô∏è 1301579675 ‚û°Ô∏è 1957582012 |
| Sales.CustomerCategories            | Sales.Orders ‚û°Ô∏è Application.People ‚û°Ô∏è Sales.CustomerCategories         | 2     | 1154103152 ‚û°Ô∏è 1301579675 ‚û°Ô∏è 2053582354 |
| Sales.CustomerTransactions          | Sales.Orders ‚û°Ô∏è Application.People ‚û°Ô∏è Sales.CustomerTransactions       | 2     | 1154103152 ‚û°Ô∏è 1301579675 ‚û°Ô∏è 366624349  |
| Sales.InvoiceLines                  | Sales.Orders ‚û°Ô∏è Application.People ‚û°Ô∏è Sales.InvoiceLines               | 2     | 1154103152 ‚û°Ô∏è 1301579675 ‚û°Ô∏è 510624862  |
| Sales.SpecialDeals                  | Sales.Orders ‚û°Ô∏è Application.People ‚û°Ô∏è Sales.SpecialDeals               | 2     | 1154103152 ‚û°Ô∏è 1301579675 ‚û°Ô∏è 1826105546 |
| Warehouse.Colors                    | Sales.Orders ‚û°Ô∏è Application.People ‚û°Ô∏è Warehouse.Colors                 | 2     | 1154103152 ‚û°Ô∏è 1301579675 ‚û°Ô∏è 2099048    |
| Warehouse.PackageTypes              | Sales.Orders ‚û°Ô∏è Application.People ‚û°Ô∏è Warehouse.PackageTypes           | 2     | 1154103152 ‚û°Ô∏è 1301579675 ‚û°Ô∏è 98099390   |
| Warehouse.StockGroups               | Sales.Orders ‚û°Ô∏è Application.People ‚û°Ô∏è Warehouse.StockGroups            | 2     | 1154103152 ‚û°Ô∏è 1301579675 ‚û°Ô∏è 194099732  |
| Warehouse.StockItemHoldings         | Sales.Orders ‚û°Ô∏è Application.People ‚û°Ô∏è Warehouse.StockItemHoldings      | 2     | 1154103152 ‚û°Ô∏è 1301579675 ‚û°Ô∏è 1474104292 |
| Warehouse.StockItems                | Sales.Orders ‚û°Ô∏è Application.People ‚û°Ô∏è Warehouse.StockItems             | 2     | 1154103152 ‚û°Ô∏è 1301579675 ‚û°Ô∏è 1314103722 |
| Warehouse.StockItemStockGroups      | Sales.Orders ‚û°Ô∏è Application.People ‚û°Ô∏è Warehouse.StockItemStockGroups   | 2     | 1154103152 ‚û°Ô∏è 1301579675 ‚û°Ô∏è 222623836  |
| Warehouse.StockItemTransactions     | Sales.Orders ‚û°Ô∏è Application.People ‚û°Ô∏è Warehouse.StockItemTransactions  | 2     | 1154103152 ‚û°Ô∏è 1301579675 ‚û°Ô∏è 638625318  |
| Sales.Customers                     | Sales.Orders ‚û°Ô∏è Sales.Customers                                        | 1     | 1154103152 ‚û°Ô∏è 802101898                 |
| Sales.Invoices                      | Sales.Orders ‚û°Ô∏è Sales.Invoices                                         | 1     | 1154103152 ‚û°Ô∏è 2018106230                |
| Sales.OrderLines                    | Sales.Orders ‚û°Ô∏è Sales.OrderLines                                       | 1     | 1154103152 ‚û°Ô∏è 94623380                  |


----

We can also determine reverse dependencies.  In this example, we identify all objects that have a foreign key path to the `Sales.Orders` table.

| Table Name                      | Path                                                              | Depth | Object ID Path                       |
|---------------------------------|-------------------------------------------------------------------|-------|--------------------------------------|
| Sales.Orders                    | Sales.Orders                                                      | 0     | 1154103152                           |
| Sales.Invoices                  | Sales.Invoices ‚¨ÖÔ∏è Sales.Orders                                    | 1     | 2018106230 ‚¨ÖÔ∏è 1154103152              |
| Sales.OrderLines                | Sales.OrderLines ‚¨ÖÔ∏è Sales.Orders                                  | 1     | 94623380 ‚¨ÖÔ∏è 1154103152                |
| Sales.CustomerTransactions      | Sales.CustomerTransactions ‚¨ÖÔ∏è Sales.Invoices ‚¨ÖÔ∏è Sales.Orders      | 2     | 366624349 ‚¨ÖÔ∏è 2018106230 ‚¨ÖÔ∏è 1154103152 |
| Sales.InvoiceLines              | Sales.InvoiceLines ‚¨ÖÔ∏è Sales.Invoices ‚¨ÖÔ∏è Sales.Orders              | 2     | 510624862 ‚¨ÖÔ∏è 2018106230 ‚¨ÖÔ∏è 1154103152 |
| Warehouse.StockItemTransactions | Warehouse.StockItemTransactions ‚¨ÖÔ∏è Sales.Invoices ‚¨ÖÔ∏è Sales.Orders | 2     | 638625318 ‚¨ÖÔ∏è 2018106230 ‚¨ÖÔ∏è 1154103152 |

----

### Temporary Stored Procedures Created

The script creates the following global temporary stored procedures. I‚Äôve modularized the logic to improve readability and maintainability.

While I won‚Äôt go into the implementation details here, you can paste the code into a large language model (LLM) to get a high-level summary of each procedure‚Äôs functionality.

```text
##temp_create_tables
##temp_sp_determine_foreign_key_paths
##temp_sp_determine_foreign_key_paths_reverse

--The following are master executions which reference the above stored procedures

##temp_sp_master_execution_foreign_key_paths
##temp_sp_master_execution_foreign_key_reverse_paths
```

---

### Usage Notes

To execute the temporary stored procedures, first run the script to create them, and then execute the procedures.

For this example, we are using the `WideWorldImports` database on the `Sales.Orders` table.  You‚Äôll need to update the script‚Äôs `USE` statement to point to the correct database.

The `##foreign_keys_map` table is available if you need details about the columns involved in each foreign key relationship.

‚ö†Ô∏è During testing, no missing index recommendations were generated and performance was not an issue. However, if performance issues do arise, you may want to consider applying a custom indexing strategy.

#### Example Execution

```sql
-- Use the following to execute the stored procedures

EXECUTE ##temp_sp_master_execution_fk_paths 'Sales.Orders'
EXECUTE ##temp_sp_master_execution_fk_reverse_paths 'Sales.Orders'

-- Use the following to view the foreign key mappings

SELECT * FROM ##table_foreign_keys_map;
```

#### Selecting a Dependency Path Procedure

Use one of the following stored procedures based on the direction of analysis. You‚Äôll need to pass the target object as a parameter:

* `##temp_sp_master_execution_fk_paths` ‚Äì Traces downstream foreign key dependencies (what the object depends on)
* `##temp_sp_master_execution_fk_reverse_paths` ‚Äì Traces upstream foreign key dependencies (what depends on the object)

---

### SQL Script

And now, without further ado, here is the script to generate foreign key dependency paths.  This script is also located in the GitHub repository.

```sql
/*----------------------------------------------------------------------------------------------------------

Determine Foreign Key Paths

üìã Instructions

Please visit the following URL for instructions
https://github.com/smpetersgithub/AdvancedSQLPuzzles/blob/main/Database%20Articles/Database%20Dependencies/06_determine_foreign_key_paths.md

1. Update the USE statement for the correct database
2. Create the temporary stored procedures
3. Execute the stored procedures

--------------------------------------------------------
--------------------------------------------------------

-- Use the following to execute the stored procedures

EXECUTE ##temp_sp_master_execution_foreign_key_paths 'Sales.Orders';
EXECUTE ##temp_sp_master_execution_foreign_key_reverse_paths 'Sales.Orders';

-- Use the following to view the foreign key mappings

SELECT * FROM ##foreign_keys_map;

----------------------------------------------------------------------------------------------------------*/

USE WideWorldImporters;
GO

-- Creates all temporary tables needed for foreign key path analysis
CREATE OR ALTER PROCEDURE ##temp_create_tables  AS
BEGIN

    PRINT('Executing ##temp_create_tables');

    -- Drop existing temporary tables to ensure clean state
    DROP TABLE IF EXISTS ##foreign_key_paths;
    DROP TABLE IF EXISTS ##foreign_key_reverse_paths;

    DROP TABLE IF EXISTS ##foreign_keys_map;

    -- Stores forward foreign key paths
    CREATE TABLE ##foreign_key_paths
    (
        [object_id] INT,
        table_name VARCHAR(256),
        object_name_path NVARCHAR(4000),
        object_id_path NVARCHAR(4000),
        depth INT,
        processed BIT DEFAULT 0
    );

    -- Stores reverse foreign key paths
    CREATE TABLE ##foreign_key_reverse_paths
    (
        [object_id] INT,
        table_name VARCHAR(256),
        object_name_path NVARCHAR(4000),
        object_id_path NVARCHAR(4000),
        depth INT,
        processed BIT DEFAULT 0
    );

    -- Build foreign key mapping table from system tables
    SELECT fk.[name] AS foreign_key_name,
           tp.[object_id] AS parent_object_id,
           s_tp.[name] AS parent_schema,
           CONCAT_WS('.', s_tp.[name], tp.[name]) AS parent_table,
           cp.[name] AS parent_column,
           refp.[object_id] AS child_id,
           s_ref.[name] AS child_schema,
           CONCAT_WS('.', s_ref.[name], refp.[name]) AS child_table,
           cref.[name] AS child_column
    INTO   ##foreign_keys_map
    FROM   sys.foreign_keys fk
    INNER JOIN sys.foreign_key_columns fkc
        ON fkc.constraint_object_id = fk.[object_id]
    INNER JOIN sys.tables tp
        ON fkc.parent_object_id = tp.[object_id]
    INNER JOIN sys.schemas s_tp
        ON tp.[schema_id] = s_tp.[schema_id]
    INNER JOIN sys.columns cp
        ON fkc.parent_object_id = cp.[object_id]
       AND fkc.parent_column_id = cp.column_id
    INNER JOIN sys.tables refp
        ON fkc.referenced_object_id = refp.[object_id]
    INNER JOIN sys.schemas s_ref
        ON refp.[schema_id] = s_ref.[schema_id]
    INNER JOIN sys.columns cref
        ON fkc.referenced_object_id = cref.[object_id]
       AND fkc.referenced_column_id = cref.column_id;
    PRINT(CONCAT('Inserted into ##foreign_keys_map: ', @@ROWCOUNT));

END;
GO

-- Determines forward foreign key paths from a starting table
CREATE OR ALTER PROCEDURE ##temp_sp_determine_foreign_key_paths (@v_object_name VARCHAR(256)) AS
BEGIN

    PRINT('Executing ##temp_sp_determine_foreign_key_paths');

    TRUNCATE TABLE ##foreign_key_paths;

    DECLARE @max_iterations INT = 100;
    DECLARE @iteration INT = 0;

    -- Seed with starting table
    INSERT INTO ##foreign_key_paths ([object_id], table_name, object_name_path, object_id_path, depth, processed)
    SELECT t.[object_id],
           CONCAT_WS('.', s.[name], t.[name]) AS table_name,
           CONCAT_WS('.', s.[name], t.[name]) AS object_name_path,
           CAST(t.object_id AS NVARCHAR(100)) AS object_id_path,
           0 AS depth,
           0 AS processed
    FROM   sys.tables t INNER JOIN
           sys.schemas s ON t.[schema_id] = s.[schema_id]
    WHERE  s.[name] + '.' + t.[name] = @v_object_name;
    PRINT(CONCAT('Inserted into ##foreign_key_paths (seed): ', @@ROWCOUNT));

    -- Process unprocessed paths iteratively
    WHILE EXISTS (SELECT 1 FROM ##foreign_key_paths WHERE processed = 0) AND @iteration < @max_iterations
    BEGIN

        PRINT('Entering WHILE loop');
        SET @iteration += 1;
        PRINT(CONCAT('Current @iteration is ', @iteration));

        -- Get next unprocessed path
        DECLARE @current_object_id INT, @current_path NVARCHAR(MAX), @current_object_id_path NVARCHAR(MAX), @current_depth INT;
        SELECT TOP (1)
               @current_object_id = [object_id],
               @current_path = object_name_path,
               @current_object_id_path = object_id_path,
               @current_depth = depth
        FROM   ##foreign_key_paths
        WHERE  processed = 0
        ORDER BY depth;

        -- Add child tables (tables that reference current table)
        INSERT INTO ##foreign_key_paths ([object_id], table_name, object_name_path, object_id_path, depth, processed)
        SELECT fk.child_id AS [object_id],
               fk.child_table AS table_name,
               CONCAT_WS(N' ‚û°Ô∏è ', @current_path, fk.child_table) AS object_name_path,
               CONCAT_WS(N' ‚û°Ô∏è ', @current_object_id_path, fk.child_id) AS object_id_path,
               @current_depth + 1 AS depth,
               0 AS processed
        FROM ##foreign_keys_map fk
        WHERE fk.parent_object_id = @current_object_id
          AND NOT EXISTS (
              SELECT 1 FROM ##foreign_key_paths
              WHERE [object_id] = fk.child_id
              AND object_name_path COLLATE DATABASE_DEFAULT LIKE '%' + fk.child_table COLLATE DATABASE_DEFAULT + '%'
          );
        PRINT(CONCAT('Inserted into ##foreign_key_paths (WHILE loop): ', @@ROWCOUNT));

        -- Add parent tables (tables that current table references)
        INSERT INTO ##foreign_key_paths ([object_id], table_name, object_name_path, object_id_path, depth, processed)
        SELECT fk.parent_object_id AS [object_id],
               fk.parent_table AS table_name,
               CONCAT_WS(N' ‚û°Ô∏è ', @current_path, fk.parent_table) AS object_name_path,
               CONCAT_WS(N' ‚û°Ô∏è ', @current_object_id_path, fk.parent_object_id) AS object_id_path,
               @current_depth + 1 AS depth,
               0 AS processed
        FROM ##foreign_keys_map fk
        WHERE fk.child_id = @current_object_id
          AND NOT EXISTS (
              SELECT 1 FROM ##foreign_key_paths
              WHERE [object_id] = fk.parent_object_id
              AND object_name_path COLLATE DATABASE_DEFAULT LIKE '%' + fk.parent_table COLLATE DATABASE_DEFAULT + '%'
          );
        PRINT(CONCAT('Inserted into ##foreign_key_paths (WHILE loop): ', @@ROWCOUNT));

        -- Mark current path as processed
        UPDATE ##foreign_key_paths
        SET    processed = 1
        WHERE  [object_id] = @current_object_id AND object_name_path = @current_path;
        PRINT(CONCAT('Update ##foreign_key_paths (WHILE loop): ', @@ROWCOUNT));

    END;

    -- Return final results
    SELECT DISTINCT
           table_name,
           object_name_path,
           depth,
           object_id_path
    FROM   ##foreign_key_paths
    ORDER BY object_name_path, depth;
    PRINT(CONCAT('Select from ##foreign_key_paths: ', @@ROWCOUNT));
END;
GO

-- Determines reverse foreign key paths (what references the starting table)
CREATE OR ALTER PROCEDURE ##temp_sp_determine_foreign_key_paths_reverse (@v_object_name VARCHAR(256)) AS
BEGIN

    PRINT('Executing ##temp_sp_determine_foreign_key_paths_reverse');

    TRUNCATE TABLE ##foreign_key_reverse_paths;

    DECLARE @max_iterations INT = 100;
    DECLARE @iteration INT = 0;

    -- Seed the table with starting table
    INSERT INTO ##foreign_key_reverse_paths ([object_id], table_name, object_name_path, object_id_path, depth, processed)
    SELECT t.[object_id],
           CONCAT_WS('.', s.[name], t.[name]) AS table_name,
           CONCAT_WS('.', s.[name], t.[name]) AS object_name_path,
           CAST(t.[object_id] AS NVARCHAR(100)) AS object_id_path,
           0 AS depth,
           0 AS processed
    FROM sys.tables t
    INNER JOIN sys.schemas s ON t.[schema_id] = s.[schema_id]
    WHERE CONCAT_WS('.', s.[name], t.[name]) = @v_object_name;
    PRINT(CONCAT('Inserted into ##foreign_key_reverse_paths (seed): ', @@ROWCOUNT));

    -- Process unprocessed paths iteratively
    WHILE EXISTS (SELECT 1 FROM ##foreign_key_reverse_paths WHERE processed = 0) AND @iteration < @max_iterations
    BEGIN

        PRINT('Entering WHILE loop');
        SET @iteration += 1;
        PRINT(CONCAT('Current @iteration is ', @iteration));

        -- Get next unprocessed path
        DECLARE @current_object_id INT, @current_path NVARCHAR(MAX), @current_object_id_path NVARCHAR(MAX), @current_depth INT;
        SELECT TOP (1)
               @current_object_id = [object_id],
               @current_path = object_name_path,
               @current_object_id_path = object_id_path,
               @current_depth = depth
        FROM   ##foreign_key_reverse_paths
        WHERE  processed = 0
        ORDER BY depth;

        -- Add parent tables (tables that reference current table)
        INSERT INTO ##foreign_key_reverse_paths ([object_id], table_name, object_name_path, object_id_path, depth, processed)
        SELECT fk.parent_object_id AS [object_id],
               fk.parent_table AS table_name,
               CONCAT_WS(N' ‚¨ÖÔ∏è ', fk.parent_table, @current_path) AS object_name_path,
               CONCAT_WS(N' ‚¨ÖÔ∏è ', fk.parent_object_id, @current_object_id_path) AS object_id_path,
               @current_depth + 1 AS depth,
               0 AS processed
        FROM ##foreign_keys_map fk
        WHERE fk.child_id = @current_object_id
          AND NOT EXISTS (
              SELECT 1 FROM ##foreign_key_reverse_paths
              WHERE [object_id] = fk.parent_object_id
              AND object_name_path COLLATE DATABASE_DEFAULT LIKE '%' + fk.parent_table COLLATE DATABASE_DEFAULT + '%'
          );
        PRINT(CONCAT('Inserted into ##foreign_key_reverse_paths (WHILE loop): ', @@ROWCOUNT));

        -- Mark current path as processed
        UPDATE ##foreign_key_reverse_paths
        SET    processed = 1
        WHERE  object_id = @current_object_id AND object_name_path = @current_path;
        PRINT(CONCAT('Update ##foreign_key_reverse_paths (WHILE loop): ', @@ROWCOUNT));
    END;

    -- Return final results
    SELECT DISTINCT
           table_name,
           object_name_path,
           depth,
           object_id_path
    FROM   ##foreign_key_reverse_paths
    ORDER BY depth, object_name_path;
    PRINT(CONCAT('Select from ##foreign_key_reverse_paths: ', @@ROWCOUNT));

END;
GO

-- Master procedure to execute forward foreign key path analysis
CREATE OR ALTER PROCEDURE ##temp_sp_master_execution_foreign_key_paths (@v_object_name VARCHAR(256)) AS
BEGIN

    PRINT('Executing ##temp_sp_master_execution_fk_paths');

    EXECUTE ##temp_create_tables;
    EXECUTE ##temp_sp_determine_foreign_key_paths @v_object_name;
END;
GO

-- Master procedure to execute reverse foreign key path analysis
CREATE OR ALTER PROCEDURE ##temp_sp_master_execution_foreign_key_reverse_paths (@v_object_name VARCHAR(256)) AS
BEGIN

    PRINT('Executing ##temp_sp_master_execution_fk_reverse_paths');

    EXECUTE ##temp_create_tables;
    EXECUTE ##temp_sp_determine_foreign_key_paths_reverse @v_object_name;
END;
GO

```
